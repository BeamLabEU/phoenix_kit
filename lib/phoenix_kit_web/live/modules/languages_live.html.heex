<PhoenixKitWeb.Components.LayoutWrapper.app_layout
  flash={@flash}
  phoenix_kit_current_scope={assigns[:phoenix_kit_current_scope]}
  page_title="{@project_title} Languages"
  current_path={@current_path}
  project_title={@project_title}
>
  <div class="container flex flex-col mx-auto px-4 py-6">
    <%!-- Header Section --%>
    <header class="w-full relative mb-6">
      <%!-- Back Button (Left aligned) --%>
      <.link
        navigate={PhoenixKit.Utils.Routes.path("/admin/modules")}
        class="btn btn-outline btn-primary btn-sm absolute left-0 top-0 -mb-12"
      >
        <PhoenixKitWeb.Components.Core.Icons.icon_arrow_left /> Back to Modules
      </.link>

      <%!-- Title Section --%>
      <div class="text-center">
        <h1 class="text-4xl font-bold text-base-content mb-3">Languages</h1>
        <p class="text-lg text-base-content">Configure and manage language support</p>
      </div>
    </header>

    <%!-- System Toggle Section --%>
    <div class="card bg-base-100 shadow-xl mb-6">
      <div class="card-body">
        <div class="flex items-center justify-between">
          <div class="flex items-center">
            <div class="text-3xl mr-4">🌐</div>
            <div>
              <h3 class="card-title text-xl">Languages</h3>
              <p class="text-base-content/70">
                Enable language support for your application
              </p>
            </div>
          </div>
          <div class="form-control">
            <label class="label cursor-pointer">
              <input
                type="checkbox"
                class="toggle toggle-primary toggle-lg"
                checked={@ml_enabled}
                phx-click="toggle_languages"
              />
            </label>
          </div>
        </div>

      </div>
    </div>

    <%= if @ml_enabled do %>
      <%!-- Languages Management Section --%>
      <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
          <div class="flex items-center justify-between mb-4">
            <h3 class="card-title text-xl">Language Configuration</h3>
            <button
              class="btn btn-primary btn-sm"
              phx-click="show_add_form"
              disabled={@show_add_form}
            >
              <PhoenixKitWeb.Components.Core.Icons.icon_plus class="w-4 h-4 mr-1" /> Add Language
            </button>
          </div>

          <%!-- Add Language Form --%>
          <%= if @show_add_form do %>
            <div class="bg-base-200 rounded-lg p-4 mb-4">
              <h4 class="font-medium text-base-content mb-3">Add New Language</h4>

              <form phx-submit="add_language" phx-change="validate_language">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                  <div class="form-control">
                    <label class="label">
                      <span class="label-text">Language Code</span>
                    </label>
                    <input
                      type="text"
                      name="language[code]"
                      value={@add_form_data["code"]}
                      placeholder="e.g., es, fr, zh-CN"
                      class={"input input-bordered #{if @add_form_errors[:code], do: "input-error", else: ""}"}
                    />
                    <%= if @add_form_errors[:code] do %>
                      <label class="label">
                        <span class="label-text-alt text-error">
                          {hd(@add_form_errors[:code])}
                        </span>
                      </label>
                    <% end %>
                  </div>

                  <div class="form-control">
                    <label class="label">
                      <span class="label-text">Language Name</span>
                    </label>
                    <input
                      type="text"
                      name="language[name]"
                      value={@add_form_data["name"]}
                      placeholder="e.g., Spanish, French, Chinese"
                      class={"input input-bordered #{if @add_form_errors[:name], do: "input-error", else: ""}"}
                    />
                    <%= if @add_form_errors[:name] do %>
                      <label class="label">
                        <span class="label-text-alt text-error">
                          {hd(@add_form_errors[:name])}
                        </span>
                      </label>
                    <% end %>
                  </div>
                </div>

                <%= if @add_form_errors[:base] do %>
                  <div class="alert alert-error mb-4">
                    <PhoenixKitWeb.Components.Core.Icons.icon_error_circle class="w-5 h-5" />
                    <span>{hd(@add_form_errors[:base])}</span>
                  </div>
                <% end %>

                <div class="flex gap-2">
                  <button
                    type="submit"
                    class="btn btn-primary btn-sm"
                    disabled={not Enum.empty?(@add_form_errors)}
                  >
                    Add Language
                  </button>
                  <button
                    type="button"
                    class="btn btn-outline btn-sm"
                    phx-click="hide_add_form"
                  >
                    Cancel
                  </button>
                </div>
              </form>
            </div>
          <% end %>

          <%!-- Languages List --%>
          <%= if Enum.empty?(@languages) do %>
            <div class="text-center py-8 text-base-content/50">
              <div class="text-4xl mb-4">🌐</div>
              <p>No languages configured yet.</p>
              <p class="text-sm">Enable the system to add your first language.</p>
            </div>
          <% else %>
            <div class="space-y-3">
              <%= for {language, index} <- Enum.with_index(@languages) do %>
                <div class="flex items-center justify-between p-4 bg-base-200 rounded-lg">
                  <div class="flex items-center flex-1">
                    <div class="text-2xl mr-3">
                      <%= case language["code"] do %>
                        <% "en" -> %>
                          🇺🇸
                        <% "es" -> %>
                          🇪🇸
                        <% "fr" -> %>
                          🇫🇷
                        <% "de" -> %>
                          🇩🇪
                        <% "pt" -> %>
                          🇵🇹
                        <% "it" -> %>
                          🇮🇹
                        <% "nl" -> %>
                          🇳🇱
                        <% "ru" -> %>
                          🇷🇺
                        <% "zh-CN" -> %>
                          🇨🇳
                        <% "ja" -> %>
                          🇯🇵
                        <% _ -> %>
                          🌐
                      <% end %>
                    </div>
                    <div class="flex-1">
                      <div class="flex items-center gap-2">
                        <span class="font-medium">{language["name"]}</span>
                        <span class="badge badge-outline badge-sm">{language["code"]}</span>
                        <%= if language["is_default"] do %>
                          <span class="badge badge-primary badge-sm">Default</span>
                        <% end %>
                      </div>
                      <div class="flex items-center gap-2">
                        <div class="btn-group">
                          <button
                            class="btn btn-outline btn-xs"
                            phx-click="move_up"
                            phx-value-code={language["code"]}
                            disabled={index == 0}
                            title="Move up"
                          >
                            ↑
                          </button>
                          <button
                            class="btn btn-outline btn-xs"
                            phx-click="move_down"
                            phx-value-code={language["code"]}
                            disabled={index == @language_count - 1}
                            title="Move down"
                          >
                            ↓
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="flex items-center gap-2">
                    <%!-- Enable/Disable Toggle --%>
                    <div class="form-control">
                      <label class="label cursor-pointer">
                        <span class="label-text mr-2 text-sm">Enabled</span>
                        <input
                          type="checkbox"
                          class="toggle toggle-sm toggle-primary"
                          checked={language["is_enabled"]}
                          phx-click="toggle_language"
                          phx-value-code={language["code"]}
                          disabled={language["is_default"]}
                        />
                      </label>
                    </div>

                    <%!-- Set Default Button --%>
                    <%= if not language["is_default"] do %>
                      <button
                        class="btn btn-outline btn-xs"
                        phx-click="set_default"
                        phx-value-code={language["code"]}
                      >
                        Set Default
                      </button>
                    <% end %>

                    <%!-- Remove Button --%>
                    <%= if not language["is_default"] and @language_count > 1 do %>
                      <button
                        class="btn btn-error btn-xs"
                        phx-click="remove_language"
                        phx-value-code={language["code"]}
                        onclick="return confirm('Are you sure you want to remove this language?')"
                      >
                        <PhoenixKitWeb.Components.Core.Icons.icon_trash class="w-3 h-3" />
                      </button>
                    <% end %>
                  </div>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>

      <%!-- Help Section --%>
      <div class="alert alert-info mt-6">
        <PhoenixKitWeb.Components.Core.Icons.icon_info class="w-5 h-5" />
        <div>
          <h3 class="font-bold">Language Configuration</h3>
          <div class="text-sm space-y-1">
            <p>• Use standard language codes like 'en', 'es', 'fr', or 'zh-CN' for regions</p>
            <p>• The default language cannot be disabled and serves as the fallback</p>
            <p>• Use the arrow buttons to reorder languages in the list</p>
            <p>• At least one language must remain configured at all times</p>
          </div>
        </div>
      </div>
    <% else %>
      <%!-- System Disabled Message --%>
      <div class="card bg-base-100 shadow-xl">
        <div class="card-body text-center py-12">
          <div class="text-6xl mb-4 opacity-50">🌐</div>
          <h3 class="text-xl font-semibold text-base-content/60 mb-2">
            Languages Disabled
          </h3>
          <p class="text-base-content/50 mb-4">
            Enable the language support above to start configuring languages for your application.
            The system will automatically create English as the default language when enabled.
          </p>
        </div>
      </div>
    <% end %>
  </div>
</PhoenixKitWeb.Components.LayoutWrapper.app_layout>
